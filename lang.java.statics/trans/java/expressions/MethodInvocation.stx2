module trans/java/expressions/MethodInvocation

imports

  trans/sig/java/expressions/MethodInvocation-sig

  trans/java/expressions/Main
  trans/java/names/MethodNames
  trans/java/names/ReceiverNames
  trans/java/names/TypeNames
  trans/java/types/ParameterizedTypes
  trans/java/types/ReferenceTypes


rules // 15.12. Method Invocation Expressions

  exprOk(s, Invoke(mthdName, exprList)) = T :-
  {Ts mthdDecl R}
    Ts == exprListOk(s, exprList),

    mthdDecl == mthdNameOk(s, mthdName, Ts),
    R == mthdDeclReturn(mthdDecl),
    T == invokeReturn(R),

    true.

  exprOk(s, InvokeQExp(ExpressionName2Expression(exprName), typeArgsOpt, id, exprList)) = T :-
  {recvDecl Ts mthdDecl R}
    recvDecl == recvNameOk(s, exprName),
    
    _ == typeArgsOptOk(s, typeArgsOpt),

    Ts == exprListOk(s, exprList),

    mthdDecl == resolveRecvMemberMthdName(recvDecl, id, Ts),
    R == mthdDeclReturn(mthdDecl),
    T == invokeReturn(R),

    true.
  
  exprOk(s, InvokeQExp(expr, typeArgsOpt, id, exprList)) = T :-
  {s_ty Ts mthdDecl R}
    s_ty == typeScope(exprOk(s, expr)),

    _ == typeArgsOptOk(s, typeArgsOpt),

    Ts == exprListOk(s, exprList),

    mthdDecl == resolveMemberMthdName(s_ty, id, Ts),
    R == mthdDeclReturn(mthdDecl),
    T == invokeReturn(R),

    true.

  exprOk(s, InvokeSuper(typeArgsOpt, id, exprList)) = T :-
  {s_ty Ts mthdDecl R}
    s_ty == typeDeclScope(super(this(s))),

    _ == typeArgsOptOk(s, typeArgsOpt),

    Ts == exprListOk(s, exprList),

    mthdDecl == resolveMemberMthdName(s_ty, id, Ts),
    R == mthdDeclReturn(mthdDecl),
    T == invokeReturn(R),

    true.

  exprOk(s, InvokeQSuper(typeName, typeArgsOpt, id, exprList)) = T :-
  {typeDecl s_ty Ts mthdDecl R}
    typeDecl == typeNameOk(s, typeName),
    s_ty == typeDeclScope(super(qualThis(typeDecl, s))),

    _ == typeArgsOptOk(s, typeArgsOpt),

    Ts == exprListOk(s, exprList),

    mthdDecl == resolveMemberMthdName(s_ty, id, Ts),
    R == mthdDeclReturn(mthdDecl),
    T == invokeReturn(R),

    true.


  invokeReturn : RETURN -> TYPE
  
  invokeReturn(TYPED(T)) = T.

  invokeReturn(VOID()) = _. // FIXME void methods are ignored; how to integrate void & expression types?

